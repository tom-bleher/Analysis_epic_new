
## Program Overview
Forked from Dhevan, Aranya and Stephen's [repository](https://github.com/dhevang/Analysis_epic), it extends the functionality of the original program to parallelize the ddsim and reconstruction processes for testing different ePIC configurations. The main program is `epic_sim2.py`, which is a modified version of the original `createSimFiles.py`. Before running the program, you need to generate the hepmc files using `createGenFiles.py`.

## Prerequisites
- Have `eic-shell` singularity container installed and configured
- Have [`ePIC`](https://github.com/eic/epic) detector installed and configured
- If using `analyzeSimFiles` `eicrecon` plugin, compile from `EICreconPlugins/analyzeLumiHits`

## Inputs 
- JSON configuration file (`simulation_settings.json`) containing simulation parameters
- ePIC detector configuration files (XML)
- `.hepmc` files generated by `createGenFiles.py`
- Singularity container image (`.sif` file)

## Flow
- Loads and validates simulation settings from JSON file
- Sets up logging infrastructure and backup directories
- Prepares detector configurations 
- Executes simulations in parallel using ProcessPoolExecutor
    - Enter `eic-shell` singularity container in subprocess
    - Source the according detector configuration file
    - Run ddsim command
    - Export `EICrecon_MY` plugin directory 
    - Run `eicrecon` command [Optional]
- Optionally runs reconstruction tasks and merges outputs

## Outputs  
- Simulated event files (ROOT files)
- Reconstruction output files (if enabled)
- Log files for each process
- README file with simulation parameters and settings

Output example (with reconstruction enabled):
```
├── beamEffectsElectrons
│   ├── 2.0x0.1px
│   │   ├── epic # modified detector configuration
│   │   ├── output_beamEffectsElectrons_20edm4hep.root # ddsim output
│   │   ├── output_beamEffectsElectrons_25edm4hep.root
│   │   ├── output_beamEffectsElectrons_30edm4hep.root
│   │   ├── podio_output.root # podio output
│   │   ├── recon # reconstruction output
│   │   │   ├── recon_output_beamEffectsElectrons_20edm4hep.root
│   │   │   ├── recon_output_beamEffectsElectrons_25edm4hep.root
│   │   │   └── recon_output_beamEffectsElectrons_30edm4hep.root
│   │   └── subprocess.log # log file for subprocess
│   ├── 1.0x0.1px
│   │   ├── epic
│   │   ├── output_beamEffectsElectrons_20edm4hep.root
│   │   ├── output_beamEffectsElectrons_25edm4hep.root
│   │   ├── output_beamEffectsElectrons_30edm4hep.root
│   │   ├── podio_output.root
│   │   ├── recon # reconstruction output
│   │   │   ├── recon_output_beamEffectsElectrons_20edm4hep.root
│   │   │   ├── recon_output_beamEffectsElectrons_25edm4hep.root
│   │   │   └── recon_output_beamEffectsElectrons_30edm4hep.root
│   │   └── subprocess.log
│   ├── overview.log # log file for main program
│   └── README.txt # README file with simulation parameters and settings
```

## Resources
- [ePIC Tutorials](https://eic.github.io/documentation/tutorials.html)
- [EIC Software Tutorial (unofficial)](https://github.com/JeffersonLab/eic-sftware-tutorial)